(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();class C{constructor(){this.video=null,this.bodyPose=null,this.poses=[],this.isReady=!1,this.isCalibrated=!1,this.standY=0,this.squatThreshold=25,this.squatState="UP",this.power=0,this.calibrationFrames=0,this.calibrationSumY=0,this.debugMsg="Initializing..."}setup(){this.video=createCapture(VIDEO),this.video.size(640,480),this.video.hide();try{this.bodyPose=ml5.bodyPose(this.video,()=>{console.log("Model Ready"),this.isReady=!0,this.bodyPose&&this.bodyPose.detectStart&&this.bodyPose.detectStart(this.video,t=>{this.poses=t})})}catch(t){console.error("ML5 Init Error:",t)}}startCalibration(){this.isCalibrated=!1,this.calibrationFrames=0,this.calibrationSumY=0,this.debugMsg="CALIBRATING... STAND TALL",console.log("Starting calibration...")}resetPower(){this.power=0}update(){if(kb.presses("c")&&this.startCalibration(),kb.presses("s")){this.addPower(20),this.playEffortSound(),this.debugMsg="MANUAL SQUAT (S key)";return}if(!this.isReady||this.poses.length===0)return;let t=this.poses[0],e=n=>t.keypoints.find(o=>o.name===n||o.part===n),s=e("left_hip")||e("leftHip")||t.keypoints[11],a=e("right_hip")||e("rightHip")||t.keypoints[12];if(!s||!a){this.debugMsg="WAITING FOR HIPS...";return}let i=(s.y+a.y)/2;if(!this.isCalibrated)this.calibrationFrames<60?(this.calibrationSumY+=i,this.calibrationFrames++):(this.standY=this.calibrationSumY/this.calibrationFrames,this.isCalibrated=!0,this.debugMsg="GO! SQUAT DOWN!");else if(this.squatState==="UP")if(i>this.standY+this.squatThreshold)this.squatState="DOWN",this.debugMsg="GOOD! NOW UP!";else{let n=this.standY+this.squatThreshold-i;this.debugMsg=`GO LOWER: ${n.toFixed(0)}px`}else this.squatState==="DOWN"&&(i<this.standY+this.squatThreshold*.5?(this.squatState="UP",this.addPower(20),this.playEffortSound(),this.debugMsg="GREAT! +POWER"):this.debugMsg="STAND UP!")}addPower(t){this.power=constrain(this.power+t,0,100)}playEffortSound(){try{const t=window.assets&&window.assets.effortSounds;if(!t||!t.length)return;const e=Math.floor(Math.random()*t.length),s=t[e];s&&typeof s.play=="function"&&(s.setVolume(2),setTimeout(()=>{if(s&&typeof s.play=="function")try{s.play()}catch{}},0))}catch{}}draw(){push(),translate(width,0),scale(-1,1),pop(),this.drawSkeleton(),this.drawLines(),this.drawDebugText()}drawLines(){if(!this.isCalibrated)return;let t=this.standY*(height/480),e=(this.standY+this.squatThreshold)*(height/480);stroke(0,255,0),strokeWeight(2),line(0,t,width,t),stroke(255,0,0),strokeWeight(4),line(0,e,width,e)}drawSkeleton(){if(!this.poses.length)return;let t=this.poses[0],e=i=>t.keypoints.find(n=>n.name===i||n.part===i),s=e("left_hip")||t.keypoints[11],a=e("right_hip")||t.keypoints[12];if(s&&a){fill(0,255,255),noStroke();let i=width-s.x*(width/640),n=s.y*(height/480),o=width-a.x*(width/640),f=a.y*(height/480);ellipse(i,n,20,20),ellipse(o,f,20,20)}}drawDebugText(){push(),fill(255),stroke(0),strokeWeight(3),textSize(24),textAlign(CENTER,TOP),text(this.debugMsg,width/2,10),textSize(14),textAlign(LEFT,BOTTOM),text("Press 'C' to Recalibrate",10,height-10),pop()}}class x{constructor(){this.currentOrder=[],this.playerStack=[],this.orderComplete=!1,this.ingMap={TOMATO:5,LETTUCE:4,CHEESE:3,PATTY:2},this.ingredients=["TOMATO","LETTUCE","CHEESE","PATTY"],this.ingYOffset={TOMATO:0,LETTUCE:0,CHEESE:0,PATTY:-12}}newOrder(){this.currentOrder=[],this.playerStack=[],this.orderComplete=!1;let t=Math.floor(random(3,6));for(let e=0;e<t;e++)this.currentOrder.push(random(this.ingredients))}update(){kb.presses("left")&&this.addIngredient("TOMATO"),kb.presses("up")&&this.addIngredient("LETTUCE"),kb.presses("down")&&this.addIngredient("CHEESE"),kb.presses("right")&&this.addIngredient("PATTY")}addIngredient(t){if(this.orderComplete)return;let e=this.currentOrder[this.playerStack.length];t===e?(this.playerStack.push(t),this.playerStack.length===this.currentOrder.length&&(this.orderComplete=!0)):this.playerStack=[]}draw(){let e=(width-100)/(this.currentOrder.length+1),s=e;for(let i=0;i<this.currentOrder.length;i++){let n=this.currentOrder[i],o=this.ingMap[n],f=s+i*e,g=55+(this.ingYOffset[n]||0);if(window.assets&&window.assets.ingredients){let r=window.assets.ingredients.width/3,h=window.assets.ingredients.height/2,c=o%3,u=Math.floor(o/3);image(window.assets.ingredients,f-20,g-20,80,80,c*r,u*h,r,h)}i<this.playerStack.length&&(fill(0,255,0),textSize(30),stroke(0),strokeWeight(3),text("âœ”",f+10,g+30))}let a=height-120;if(window.assets&&window.assets.ingredients){let i=window.assets.ingredients.width/3,n=window.assets.ingredients.height/2;image(window.assets.ingredients,width/2-40,a,80,40,1*i,0,i,n);let o=a-15;for(let f of this.playerStack){let g=this.ingMap[f],r=g%3,h=Math.floor(g/3);image(window.assets.ingredients,width/2-35,o,70,35,r*i,h*n,i,n),o-=25}this.orderComplete&&image(window.assets.ingredients,width/2-40,o-10,80,40,0,0,i,n)}this.drawControls()}drawControls(){let t=height-50,e=100,s=width/2-1.5*e;[{key:"<",ing:"TOMATO",color:"#ff4444"},{key:"^",ing:"LETTUCE",color:"#44ff44"},{key:"v",ing:"CHEESE",color:"#ffff44"},{key:">",ing:"PATTY",color:"#8b4513"}].forEach((i,n)=>{let o=s+n*e;if(fill(i.color),stroke(255),strokeWeight(4),ellipse(o,t,70,70),window.assets&&window.assets.ingredients){let f=this.ingMap[i.ing],g=window.assets.ingredients.width/3,r=window.assets.ingredients.height/2,h=f%3,c=Math.floor(f/3),u=this.ingYOffset[i.ing]||0,w=i.ing==="PATTY"?-24:0;image(window.assets.ingredients,o-25,t-25+u+16+w,50,50,h*g,c*r,g,r)}}),fill(255),noStroke(),textAlign(CENTER),textSize(16),text("HIT THE BUTTONS TO ASSEMBLE THE BURGER",width/2,height-100)}}class k{constructor(){this.particles=[]}emit(t,e,s){let a={x:t,y:e,vx:random(-1,1),vy:random(-2,-.5),life:255,type:s};this.particles.push(a)}update(){for(let t=this.particles.length-1;t>=0;t--){let e=this.particles[t];e.x+=e.vx,e.y+=e.vy,e.life-=5,e.type==="FIRE"&&(e.vy*=.95,e.life-=8),e.life<=0&&this.particles.splice(t,1)}}draw(){noStroke();for(let t of this.particles)t.type==="FIRE"?(fill(255,random(100,200),0,t.life),rect(t.x,t.y,random(4,8),random(4,8))):t.type==="SMOKE"&&(fill(100,100,100,t.life),rect(t.x,t.y,random(6,12),random(6,12)))}}class I{constructor(){this.baseY=450,this.startX=500,this.onAngry=null,this.reset()}reset(){this.x=this.startX,this.y=this.baseY,this.targetX=800,this.speed=1.5,this.scale=1,this.isWalking=!0,this.isLeaving=!1,this.isAngry=!1,this.arrivalTime=null,this.waitTime=0,this.clientType=Math.random()<.5?"client":"client2"}startLeaving(){this.isLeaving=!0,this.isWalking=!1}update(){if(this.isLeaving){this.x-=this.speed,this.y=this.baseY+Math.sin(frameCount*.2)*3,this.scale=1+Math.sin(frameCount*.2)*.01;return}this.isWalking&&this.x<this.targetX?(this.x+=this.speed,this.y=this.baseY+Math.sin(frameCount*.2)*3,this.scale=1+Math.sin(frameCount*.2)*.01,this.x>=this.targetX&&(this.isWalking=!1,this.arrivalTime=frameCount,this.waitTime=0)):this.isWalking||(this.y=this.baseY,this.scale=1,this.waitTime++,this.waitTime>=300&&!this.isAngry&&(this.isAngry=!0,this.onAngry&&this.onAngry()),this.waitTime>=600&&(this.isLeaving=!0))}hasLeft(){return this.isLeaving&&this.x<=this.startX}draw(){if(window.assets){let t=this.clientType==="client2"?window.assets.client2:window.assets.client,e=this.clientType==="client2"?window.assets.client2Angry:window.assets.clientAngry,s=this.isAngry?e:t;if(s){push(),translate(this.x,this.y);let a=this.isLeaving?.4:-.4;scale(a,this.scale*.4),imageMode(CENTER),image(s,0,0),pop()}}}}class O{constructor(){this.phases={MENU:"MENU",INSTRUCTIONS:"INSTRUCTIONS",CALIBRATION:"CALIBRATION",SQUATTING:"SQUATTING",ASSEMBLING:"ASSEMBLING",GAMEOVER:"GAMEOVER"},this.currentPhase=this.phases.MENU,this.score=0,this.time=15,this.instructionsTimer=0,this.burgersCompleted=0,this.squatDetector=new C,this.burgerBuilder=new x,this.particles=new k,this.client=null,this.leavingClients=[],this.musicStarted=!1,this.cookingSoundStarted=!1}resetRun(){this.score=0,this.burgersCompleted=0,this.time=15,this.client=null,this.leavingClients=[],this.squatDetector.resetPower()}changePhase(t){this.currentPhase=t,t===this.phases.INSTRUCTIONS?this.instructionsTimer=0:t===this.phases.CALIBRATION?this.squatDetector.startCalibration():t===this.phases.SQUATTING?(this.squatDetector.resetPower(),this.ensureActiveClient(),this.stopCookingSound()):t===this.phases.ASSEMBLING?(this.burgerBuilder.newOrder(),this.startCookingSound()):t===this.phases.GAMEOVER&&(this.stopBackgroundMusic(),this.stopCookingSound(),this.playLoseSound())}update(){switch(this.client&&this.client.update(),this.leavingClients.forEach(t=>t.update()),this.leavingClients=this.leavingClients.filter(t=>!t.hasLeft()),this.particles.update(),(this.currentPhase===this.phases.ASSEMBLING||this.currentPhase===this.phases.SQUATTING)&&(frameCount%60===0&&this.time>0&&this.time--,this.time<=0&&(this.stopBackgroundMusic(),this.changePhase(this.phases.GAMEOVER))),this.currentPhase){case this.phases.MENU:kb.presses("space")&&(this.resetRun(),this.playBackgroundMusic(),this.changePhase(this.phases.INSTRUCTIONS));break;case this.phases.INSTRUCTIONS:if(this.instructionsTimer++,kb.presses("space")){this.playBackgroundMusic(),this.changePhase(this.phases.CALIBRATION);break}this.instructionsTimer>480&&this.changePhase(this.phases.CALIBRATION);break;case this.phases.CALIBRATION:this.squatDetector.update(),this.squatDetector.isCalibrated&&this.changePhase(this.phases.SQUATTING);break;case this.phases.SQUATTING:this.squatDetector.update(),this.squatDetector.power>=100&&this.changePhase(this.phases.ASSEMBLING);break;case this.phases.ASSEMBLING:if(this.burgerBuilder.update(),this.client&&this.client.hasLeft()){this.changePhase(this.phases.GAMEOVER);break}this.burgerBuilder.orderComplete&&(this.playCompleteSound(),this.stopCookingSound(),this.sendCurrentClientAway(),this.spawnNextClient(),this.score+=100,this.time+=10,this.particles.emit(width/2,height/2,"FIRE"),this.burgersCompleted++,this.changePhase(this.phases.SQUATTING));break;case this.phases.GAMEOVER:kb.presses("space")&&(this.resetRun(),this.playBackgroundMusic(),this.changePhase(this.phases.MENU));break}}ensureActiveClient(){this.client||this.spawnNextClient()}spawnNextClient(){const t=new I;t.reset(),t.onAngry=()=>this.playAngrySound(),this.client=t}sendCurrentClientAway(){this.client&&(this.client.startLeaving(),this.leavingClients.push(this.client),this.client=null)}playBackgroundMusic(){if(this.musicStarted)return;const t=window.assets&&window.assets.backgroundMusic;if(t&&typeof t.play=="function")try{t.setLoop(!0),t.setVolume(.15),setTimeout(()=>{if(t&&typeof t.play=="function")try{t.play(),this.musicStarted=!0}catch{}},0)}catch{}}stopBackgroundMusic(){const t=window.assets&&window.assets.backgroundMusic;if(t&&typeof t.stop=="function")try{t.stop()}catch{}this.musicStarted=!1}startCookingSound(){if(this.cookingSoundStarted)return;const t=window.assets&&window.assets.cookingSound;if(t&&typeof t.play=="function")try{t.setLoop(!0),t.setVolume(.5),setTimeout(()=>{if(t&&typeof t.play=="function")try{t.play(),this.cookingSoundStarted=!0}catch{}},0)}catch{}}stopCookingSound(){const t=window.assets&&window.assets.cookingSound;if(t&&typeof t.stop=="function")try{t.stop()}catch{}this.cookingSoundStarted=!1}playCompleteSound(){const t=window.assets&&window.assets.completeSound;if(t&&typeof t.play=="function")try{t.setVolume(2),setTimeout(()=>{if(t&&typeof t.play=="function")try{t.play()}catch{}},0)}catch{}}playLoseSound(){const t=window.assets&&window.assets.loseSound;if(t&&typeof t.play=="function")try{t.setVolume(1.2),setTimeout(()=>{if(t&&typeof t.play=="function")try{t.play()}catch{}},0)}catch{}}playAngrySound(){const t=window.assets&&window.assets.angrySound;if(t&&typeof t.play=="function")try{t.setVolume(1.2),setTimeout(()=>{if(t&&typeof t.play=="function")try{t.play()}catch{}},0)}catch{}}draw(){background("#000233"),window.assets&&window.assets.bg&&image(window.assets.bg,0,0,width,height),this.drawCityBg(),this.drawChef(),this.drawBigChef(),this.drawFlamme(),this.drawBarbecue(),this.drawDesk(),(this.currentPhase===this.phases.SQUATTING||this.currentPhase===this.phases.ASSEMBLING)&&this.drawClients(),this.drawLayout(),this.drawIngFrame(),this.currentPhase===this.phases.ASSEMBLING&&this.burgerBuilder.draw(),this.drawGaugeFill(),this.particles.draw(),this.drawPhaseOverlays()}drawClients(){this.leavingClients.forEach(t=>t.draw()),this.client&&this.client.draw()}drawChef(){let f=-16,g=450,r=window.assets.chefDebout;this.squatDetector.squatState==="DOWN"&&(r=window.assets.chefSquat),r&&image(r,f,g,140,140)}drawBigChef(){if(window.assets&&window.assets.bigChef){const s=width/2-125+220,a=height/2-250/2+60;image(window.assets.bigChef,s,a,250,250)}}drawLayout(){fill(0,0,0,200),noStroke(),rect(0,0,width,30),fill(255,255,0),textAlign(CENTER,CENTER),textSize(18),textStyle(BOLD);let t=Math.floor(this.time/60),e=this.time%60,s=`${t}:${e<10?"0"+e:e}`;text(`BURGERS: ${this.burgersCompleted}      TIME: ${s}`,width/2,15),textStyle(NORMAL),window.assets&&window.assets.frame&&image(window.assets.frame,10,35,width-20,80)}drawIngFrame(){window.assets&&window.assets.ingFrame&&image(window.assets.ingFrame,10,35,width-20,80)}drawGaugeFill(){let t=this.squatDetector.power;const e=window.assets&&window.assets.flameFrames,s=10,a=140,i=90,n=300,o=50,f=220,g=s+Math.round((i-o)/2),h=a+n-20-f;if(e&&e.length&&t>=0){let c=Math.floor(map(t,0,100,0,e.length-1));c=constrain(c,0,e.length-1),image(e[c],g,h,o,f)}fill(255),textAlign(CENTER),textSize(12),text("POWER",s+i/2,140)}drawPhaseOverlays(){switch(this.currentPhase){case this.phases.MENU:this.drawOverlay("PANIC BURGER","PRESS SPACE TO START");break;case this.phases.INSTRUCTIONS:this.drawInstructionsOverlay();break;case this.phases.CALIBRATION:this.drawOverlay("CALIBRATION","STAND UPRIGHT"),this.squatDetector.drawSkeleton();break;case this.phases.GAMEOVER:this.drawGameOverOverlay();break;case this.phases.SQUATTING:this.drawSquattingOverlay();break}}drawOverlay(t,e){textFont("Press Start 2P"),fill(0,0,0,200),rect(0,0,width,height),textAlign(CENTER),fill(255),textSize(40),text(t,width/2,height/2-20),textSize(20),text(e,width/2,height/2+30)}drawInstructionsOverlay(){textFont("Press Start 2P"),fill(0,0,0,200),rect(0,0,width,height),textAlign(CENTER),fill(255,255,0),textSize(48),text("HOW TO PLAY",width/2,60),fill(255),textSize(20);let t=140,e=30,s=20;text("1. SQUAT to fill the",width/2,t),t+=e,text("   POWER BAR",width/2,t),t+=e+s,text("2. When FULL, assemble",width/2,t),t+=e,text("   the burger using the",width/2,t),t+=e,text("   BUTTONS to match the",width/2,t),t+=e,text("   order at the top",width/2,t),t+=e+s,text("3. Complete orders before",width/2,t),t+=e,text("   time runs out!",width/2,t),t=height-70,textSize(18),fill(255,255,0),text("PRESS SPACE TO START",width/2,t)}drawSquattingOverlay(){textFont("Press Start 2P"),fill(255),textAlign(CENTER,CENTER),textSize(60),text("SQUAT",width/2,height/2)}drawGameOverOverlay(){textFont("Press Start 2P"),fill(0,0,0,200),rect(0,0,width,height),textAlign(CENTER),fill(255),textSize(40),text("GAME OVER",width/2,height/2-60),fill(255,255,0),textSize(28),text(`BURGERS: ${this.burgersCompleted}`,width/2,height/2-20),fill(255),textSize(18),text("PRESS SPACE TO PLAY AGAIN",width/2,height/2+40)}drawCityBg(){if(window.assets&&window.assets.cityBg){const s=1200*(window.assets.cityBg.height/window.assets.cityBg.width),a=width-1200-40,i=height/2-s/2+20;image(window.assets.cityBg,a,i,1200,s)}}drawDesk(){if(window.assets&&window.assets.desk){const s=400*(window.assets.desk.height/window.assets.desk.width),a=width/2,i=height/2-s/2+190;image(window.assets.desk,a,i,400,s)}}drawBarbecue(){if(window.assets&&window.assets.barbecue){const s=350*(window.assets.barbecue.height/window.assets.barbecue.width),a=width/2+410,i=height/2-s/2+120;image(window.assets.barbecue,a,i,350,s)}}drawFlamme(){if(window.assets&&window.assets.flamme){const s=width/2-75+550,a=height/2-200/2+100,n=frameCount*(.15*8);for(let o=0;o<4;o++){const f=n+o*.3,g=(o-1.5)*.25,r=sin(f*2.5)*1.2,h=cos(f*3.3)*.6,c=g+r+h,u=255*(1-o*.25);push(),translate(s+150/2,a+200/2),rotate(c),tint(255,255,255,u),imageMode(CENTER),image(window.assets.flamme,0,0,150,200),pop()}noTint()}}}let y;function d(l){l.loadPixels();const t=l.width,e=l.height;if(t===0||e===0)return;const s=new Uint8Array(t*e),a=[],i=[[0,0],[t-1,0],[0,e-1],[t-1,e-1]];let n=l.pixels[0],o=l.pixels[1],f=l.pixels[2];function g(r,h,c,u){return dist(h,c,u,n,o,f)<50||h>190&&c>190&&u>190&&Math.abs(h-c)<15&&Math.abs(c-u)<15}for(let r of i){let h=r[0],c=r[1],u=(c*t+h)*4,w=l.pixels[u],p=l.pixels[u+1],m=l.pixels[u+2];g(u,w,p,m)&&(a.push([h,c]),s[c*t+h]=1)}for(;a.length>0;){const[r,h]=a.shift(),c=(h*t+r)*4;l.pixels[c+3]=0;const u=[[r+1,h],[r-1,h],[r,h+1],[r,h-1]];for(let w of u){let p=w[0],m=w[1];if(p>=0&&p<t&&m>=0&&m<e){let T=m*t+p;if(s[T]===0){let S=T*4,b=l.pixels[S],A=l.pixels[S+1],E=l.pixels[S+2];g(S,b,A,E)&&(s[T]=1,a.push([p,m]))}}}}l.updatePixels()}window.preload=function(){window.assets={},window.assets.ingredients=loadImage("assets/ingredients.png",d),window.assets.ingFrame=loadImage("assets/frame.png",d),window.assets.chefDebout=loadImage("assets/chef-debout.png",d),window.assets.chefSquat=loadImage("assets/chef-squat.png",d),window.assets.chef=loadImage("assets/chef_sheet.png",d),window.assets.chefGym=loadImage("assets/chef_gym.png",d),window.assets.cityBg=loadImage("assets/city.png",d),window.assets.client=loadImage("assets/client.png",d),window.assets.clientAngry=loadImage("assets/client-angry.png",d),window.assets.client2=loadImage("assets/client2.png",d),window.assets.client2Angry=loadImage("assets/client2-angry.png",d),window.assets.bigChef=loadImage("assets/chef.png",d),window.assets.desk=loadImage("assets/desk.png",d),window.assets.barbecue=loadImage("assets/barbecue.png",d),window.assets.frame=loadImage("assets/blue_frame.png",d),window.assets.flameFrames=[loadImage("assets/flame/flame-1.png",d),loadImage("assets/flame/flame-2.png",d),loadImage("assets/flame/flame-3.png",d),loadImage("assets/flame/flame-4.png",d),loadImage("assets/flame/flame-5.png",d)],window.assets.buttons=loadImage("assets/buttons.png",d),window.assets.flamme=loadImage("assets/flamme.svg"),window.assets.backgroundMusic=loadSound("assets/sound/background.mp3"),window.assets.cookingSound=loadSound("assets/sound/cooking.mp3"),window.assets.completeSound=loadSound("assets/sound/complete.mp3"),window.assets.loseSound=loadSound("assets/sound/lose.mp3"),window.assets.angrySound=loadSound("assets/sound/angry.mp3"),window.assets.effortSounds=[loadSound("assets/sound/effort/effort-1.mp3"),loadSound("assets/sound/effort/effort-2.mp3"),loadSound("assets/sound/effort/effort-3.mp3"),loadSound("assets/sound/effort/effort-4.mp3")]};window.setup=function(){createCanvas(windowWidth,windowHeight).parent("app"),noSmooth(),y=new O,y.squatDetector.setup(),console.log("Setup complete. Assets loaded.")};window.draw=function(){y&&(y.update(),y.draw())};
